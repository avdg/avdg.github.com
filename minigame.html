<!DOCTYPE html>
<html><head><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script><script type="text/javascript">(function(){var t,e,i,o,s,n,l,c,r,h,a,u,k,f
r={locale:!1,debug:!1,style:"srs"},e={_:!1,blockTypes:"ijlotsz".split(""),blocks:{srs:{rotate:function(t){return[t[1],-t[0]]},derotate:function(t){return[-t[1],t[0]]},opposite:function(t){return[-t[0],-t[1]]},initials:{i:[[0,-1],[0,0],[0,1],[0,2]],j:[[-1,-1],[0,-1],[0,0],[0,1]],l:[[0,-1],[0,0],[0,1],[-1,1]],o:[[-1,0],[0,0],[-1,1],[0,1]],s:[[0,-1],[0,0],[-1,0],[-1,1]],t:[[-1,0],[0,-1],[0,0],[0,1]],z:[[-1,-1],[-1,0],[0,0],[0,1]]},kickTable:{right:{o:[[],[],[],[]],i:[[[-2,0],[1,0],[-2,-1],[1,2]],[[-1,0],[2,0],[-1,2],[2,-1]],[[2,0],[-1,0],[2,1],[-1,-2]],[[1,0],[-2,0],[1,-2],[-2,1]]],"default":[[[-1,0],[-1,1],[0,-2],[-1,-2]],[[1,0],[1,-1],[0,2],[1,2]],[[1,0],[1,1],[0,-2],[1,-2]],[[-1,0],[-1,-1],[0,2],[-1,2]]]},left:{o:[[],[],[],[]],i:[[[2,0],[-1,0],[2,1],[-1,-2]],[[1,0],[-2,0],[1,-2],[-2,1]],[[-2,0],[1,0],[-2,-1],[1,2]],[[-1,0],[2,0],[-1,2],[2,-1]]],"default":[[[1,0],[1,-1],[0,2],[1,2]],[[-1,0],[-1,1],[0,-2],[-1,2]],[[-1,0],[-1,-1],[0,2],[-1,2]],[[1,0],[1,1],[0,-2],[1,-2]]]}},offsets:{i:[[[0,0],[-1,0],[2,0],[-1,0],[2,0]],[[-1,0],[0,0],[0,0],[0,1],[0,-2]],[[-1,2],[1,1],[-2,1],[1,0],[-2,0]],[[0,1],[0,1],[0,1],[0,-1],[0,2]]],o:[[[0,0]],[[0,-1]],[[-1,-1]],[[-1,0]]],"default":[[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[-1,0],[-1,1],[0,2],[-1,2]]]},color:{i:"rgba(0,255,255,.9)",j:"rgba(0,0,255,.9)",l:"rgba(255,170,0,.9)",o:"rgba(255,255,0,.9)",s:"rgba(0,255,0,.9)",t:"rgba(153,0,255,.9)",z:"rgba(255,0,0,.9)"},blocks:{}}},images:{cache:{},links:{clown:"http://tweakers.net/ext/f/QiUS8Q3QxzG4yC76TOl0RSHI/full.jpg",nature:"http://www.finewallpaperss.com/wp-content/uploads/2012/09/green-nature-wallpaper1.jpg"},offline:{clown:"img/clown.jpg",nature:"img/green-nature-wallpaper.jpg"}}},l=function(){var t,i,o,s,l,c,r,h,a,u,k
if(!e._){for(n("clown"),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()),a=e.blockTypes,l=0,h=a.length,k=1;h>l;l+=k)for(t=a[l],s=e.blocks.srs.initials[t].slice(0),e.blocks.srs.blocks[t]=[],i=c=0;4>c;i=c+=1)for(e.blocks.srs.blocks[t][i]=$.extend(!0,[],s),o=r=0,u=e.blocks.srs.initials[t].length;u>r;o=r+=1)s[o]=e.blocks.srs.rotate(s[o])
e._=!0}},t=function(){function t(){this.achievements={}}return t.prototype.add=function(t,e){this.achievement[t]={msg:e,unlocked:!1}},t.prototype.unlock=function(t){return(this.achievement[t].unlocked=!1)?(this.achievement[t].unlocked=!0,!0):!1},t.prototype.unlocked=function(t){return this.achievement[t].unlocked},t}(),k=function(){function t(){this.resetState(!0)}return t.prototype.resetState=function(t){var e,i,o,s,n
for(null==t&&(t=!1),this.activeBlock={block:null,rotation:null,w:null,h:null},this.display=[],this.wall=0,this.lineOffsets=[],this.hold=null,this.holdDisabled=!1,this.holdLock=!1,this.queue=[],this.totalLines=0,this.totalBlocksDropped=0,this.linesSingle=0,this.linesDouble=0,this.linesTriple=0,this.linesQuadro=0,t&&(this.settings=$.extend(!0,{},r)),this.rotationStyle="srs",e=o=0;24>o;e=++o)for(this.display[e]=[],i=s=0;10>s;i=++s)this.display[e][i]=null
for(e=n=0;20>n;e=++n)this.lineOffsets[e]=0
this.fillQueue(),this.nextBlock()},t.prototype.fillQueue=function(t){for(null==t&&(t=7);t>this.queue.length;)this.queue=this.queue.concat(h(e.blockTypes))},t.prototype.nextBlock=function(t,e){var i,o
for(null==t&&(t=1),null==e&&(e=7),i=o=0;t>o;i=o+=1)this.activeBlock.block=this.queue.shift(),this.activeBlock.rotation=0,this.activeBlock.h=18,this.activeBlock.w=4,e>this.queue.length&&this.fillQueue(e)},t.prototype.tryActiveBlockPosition=function(t,e,i){var o,s,n
for(o=s=0,n=i.length;n>s;o=s+=1){if(0>e-i[o][0]||e-i[o][0]>=20)return!1
if(0>t+i[o][1]||t+i[o][1]>=10)return!1
if(null!==this.display[e-i[o][0]][t+i[o][1]])return!1}return!0},t.prototype.storeBlock=function(){var t
this.holdDisabled||this.holdLock||(null===this.hold?(this.hold=this.activeBlock.block,this.nextBlock()):(t=[this.activeBlock.block,this.hold],this.hold=t[0],this.activeBlock.block=t[1],this.activeBlock.rotation=0,this.activeBlock.h=18,this.activeBlock.w=4),this.holdLock=!0,this.updateDisplay())},t.prototype.moveLeft=function(){this.tryActiveBlockPosition(this.activeBlock.w-1,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])&&(this.activeBlock.w-=1,this.updateDisplay())},t.prototype.moveRight=function(){this.tryActiveBlockPosition(this.activeBlock.w+1,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])&&(this.activeBlock.w+=1,this.updateDisplay())},t.prototype.moveDown=function(){this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h-1,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])?(this.activeBlock.h-=1,this.updateDisplay()):this.lock()},t.prototype.doDrop=function(){for(;this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h-1,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation]);)this.activeBlock.h-=1
this.lock()},t.prototype.rotateRight=function(){var t
t=(this.activeBlock.rotation+1)%4,this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][t])&&(this.activeBlock.rotation=t,this.updateDisplay())},t.prototype.rotateLeft=function(){var t
t=(this.activeBlock.rotation+3)%4,this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][t])&&(this.activeBlock.rotation=t,this.updateDisplay())},t.prototype.lock=function(){var t,i,o,s
for(this.holdLock=!1,this.totalBlocksDropped+=1,t=e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation],i=o=0,s=t.length;s>o;i=o+=1)this.display[this.activeBlock.h-t[i][0]][this.activeBlock.w+t[i][1]]=e.blocks.srs.color[this.activeBlock.block]
this.removeLines(),this.nextBlock(),this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])||this.resetState(),this.updateDisplay()},t.prototype.removeLines=function(){var t,e,i,o,s,n,l,c
for(o=0,e=s=0,l=this.display.length;l>s;e=s+=1){for(t=!0,i=n=0,c=this.display[e].length;c>n;i=n+=1)this.display[e-o][i]=this.display[e][i],null===this.display[e][i]&&(t=!1)
t&&(o+=1)}switch(this.totalLines+=o,o){case 1:this.linesSingle+=1
break
case 2:this.linesDouble+=1
break
case 3:this.linesTriple+=1
break
case 4:this.linesQuadro+=1}this.updateDisplay()},t.prototype.updateDisplay=function(){},t.prototype.gameOver=function(){},t}(),i=function(){function t(t,e,i,o,s,n){this.resetSettings(),this.x=t,this.y=e,this.w=i,this.h=o,this.c=s,this.s=n,this.c.lineWidth=0}return t.prototype.resetSettings=function(){this.options={defaultClearColor:"rgb(255, 255, 255)",defaultBlockColor:"rgba(0, 0, 0, .5)",defaultBgColor:"rgb(0, 0, 0)",defaultBlockBgColor:"rgba(255, 255, 255, .3)",defaultGridBgColor:"rgba(255, 255, 255, .5)",image:"clown",rows:20,cols:10}},t.prototype.clearScreen=function(t){null==t&&(t=this.options.defaultClearColor),this.c.fillStyle=t,this.c.fillRect(this.x,this.y,this.w,this.h)},t.prototype.drawImageBackground=function(t,e,i,o,s){var l,c,r,h,a,u,k
null==s&&(s={}),r=24,c=i/r,l=o/r,a=c/2,h=n(null!=(u=s.image)?u:this.options.image),this.c.beginPath(),this.c.strokeStyle=this.c.fillStyle=null!=(k=s.defaultBgColor)?k:this.options.defaultBgColor,this.c.lineWidth=1,this.c.moveTo(t+2*c,e+l),this.c.arcTo(t+23*c,e+l,t+23*c,e+2*l,a),this.c.arcTo(t+23*c,e+23*l,t+22*c,e+23*l,a),this.c.arcTo(t+c,e+23*l,t+c,e+22*l,a),this.c.arcTo(t+c,e+l,t+2*c,e+l,a),this.c.closePath(),this.c.clip(),this.c.drawImage(h,t+c,e+l,i-c,o-l),this.c.restore(),this.c.lineWidth=0},t.prototype.drawGameGrid=function(t,i,o,s,n){var l,c,r,h,a,u,k,f,p,y,d,v,w,B,g,b,m,D,x,C
for(null==n&&(n={}),y=null!=(b=n.rows)?b:this.options.rows,r=null!=(m=n.cols)?m:this.options.cols,h=null!=(D=n.defaultBlockColor)?D:this.options.defaultBlockColor,a=null!=(x=n.defaultGridBgColor)?x:this.options.defaultGridBgColor,l=s/y,c=o/r,this.c.fillStyle=a,this.c.fillRect(t,i,o,s),this.c.fillStyle=h,k=d=0;y>d;k=d+=1)for(f=v=0;r>v;f=v+=1)this.c.fillRect(t+c*f+1,i+l*k+1,c-2,l-2)
for(p=0,u=l,k=w=0;y>w&&(p+=l+this.s.lineOffsets[k],s+.05>p);k=w+=1){for(p+l>s+.05&&(u=p+l-s),f=B=0;r>B;f=B+=1)null!==this.s.display[k][f]&&(this.c.fillStyle=this.s.display[k][f],this.c.fillRect(t+c*f+1,i+s-p+1,c-2,u-2))
for(f=g=0,C=e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation].length;C>g;f=g+=1)this.s.activeBlock.h-e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][f][0]===k&&(this.c.fillStyle=e.blocks.srs.color[this.s.activeBlock.block],this.c.fillRect(t+c*(e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][f][1]+this.s.activeBlock.w)+1,i+s-p+1,c-2,c-2))}},t.prototype.drawBox=function(t,i,o,s,n,l){var c,r,h,a,u,k,f,p,y,d,v,w,B,g,b,m,D,x,C,P,S
if(null==l&&(l={}),a=null!=(m=l.defaultBlockBgColor)?m:this.options.defaultBlockBgColor,h=o/4,r=s/4,"string"==typeof n?(c=null!=(D=null!=(x=l.blockColor)?x:e.blocks.srs.color[n])?D:this.options.defaultBlockColor,n=e.blocks.srs.blocks[n][0]):c=null!=(C=l.blockColor)?C:this.options.defaultBlockColor,this.c.fillStyle=a,this.c.fillRect(t,i,o,s),null!==n){for(y=f=n[0][0],d=p=n[0][1],k=g=1,P=n.length;P>g;k=g+=1)y>n[k][0]?y=n[k][0]:n[k][0]>f&&(f=n[k][0]),d>n[k][1]?d=n[k][1]:n[k][1]>p&&(p=n[k][1])
for(B=p-d+1,u=f-y+1,v=(4-B)/2*h,w=(4-u)/2*r,this.c.fillStyle=c,k=b=0,S=n.length;S>b;k=b+=1)this.c.fillRect(t+v+(n[k][1]-d)*h+1,i+w+(n[k][0]-y)*r+1,h-2,r-2)}},t.prototype.draw=function(){var t,e,i
i=(new Date).getDate(),e=this.w/24,t=this.h/24,this.clearScreen(),this.drawImageBackground(this.x,this.y,this.w,this.h),this.drawGameGrid(this.x+7*e,this.y+2*t,10*e,20*t),this.drawBox(this.x+18*e,this.y+2*t,4*e,4*t,this.s.queue[0]),this.drawBox(this.x+18*e,this.y+7*t,4*e,4*t,this.s.queue[1]),this.drawBox(this.x+18*e,this.y+12*t,4*e,4*t,this.s.queue[2]),this.drawBox(this.x+18*e,this.y+17*t,4*e,4*t,this.s.queue[3]),this.drawBox(this.x+2*e,this.y+2*t,4*e,4*t,this.s.hold),r.debug&&console.debug((new Date).getDate()-i+" ms spend drawing")},t}(),c=function(){function t(t){var e=this
null==t&&(t=!0),this.keys={keyUp:{},keyDown:{},keyPress:{}},this.keyDownFunction=function(t){return e.onKeyDown(t)},this.keyUpFunction=function(t){return e.onKeyUp(t)},this.keyPressFunction=function(t){return e.onKeyPress(t)},t&&this.registerEventHandlers()}return t.prototype.registerEventHandlers=function(){document.addEventListener("keydown",this.keyDownFunction,!1),document.addEventListener("keyup",this.keyUpFunction,!1),document.addEventListener("keypress",this.keyPressFunction,!1)},t.prototype.unregisterEventHandlers=function(){document.removeEventListener("keydown",this.keyDownFunction,!1),document.removeEventListener("keyup",this.keyUpFunction,!1),document.removeEventListener("keypress",this.keyPressFunction,!1)},t.prototype.registerKeyDown=function(t,e){this.keys.keyDown[t]=e},t.prototype.registerKeyUp=function(t,e){this.keys.keyUp[t]=e},t.prototype.registerKeyPress=function(t,e){this.keys.keyPress[t]=e},t.prototype.onKeyDown=function(t){var e
return e=t.which,"function"==typeof this.keys.keyDown[e]?this.keys.keyDown[e](t):"function"==typeof this.keys.keyDown["default"]?this.keys.keyDown["default"]:void 0},t.prototype.onKeyUp=function(t){var e
return e=t.which,"function"==typeof this.keys.keyUp[e]?this.keys.keyUp[e](t):"function"==typeof this.keys.keyUp["default"]?this.keys.keyUp["default"]:void 0},t.prototype.onKeyPress=function(t){var e
return e=t.which,"function"==typeof this.keys.keyPress[e]?this.keys.keyPress[e](t):"function"==typeof this.keys.keyPress["default"]?this.keys.keyPress["default"]:void 0},t.prototype.getKeyCode=function(){},t}(),h=function(t){var e,i,o,s,n,l
for(o=$.extend(!0,[],t),e=n=1,l=o.length;l>n;e=n+=1)i=Math.floor(Math.random()*(e+1)),s=o[e],o[e]=o[i],o[i]=s
return o},s=function(t,e){for(var i;0!==e;)i=[e,t%e],t=i[0],e=i[1]
return t},u=function(t,e,i,o){return i/o>t/e?o=e*i/t:i=t*o/e,[i,o]},a=function(t,e,i,o){return i/o>t/e?(i-=i%s(t,e),o=e*i/t):(o-=o%s(e,t),i=t*o/e),[i,o]},n=function(t){return e.images.cache[t]||(e.images.cache[t]=new Image,e.images.cache[t].src=e.images[r.locale?"offline":"links"][t],e.images.cache[t])},f=function(){function t(t){var o=this
l(),null==t&&(t="game"),this.c=document.getElementById(t).getContext("2d"),this.state=new k,r.debug&&(this.cache=e),this.drawer=new i(0,0,this.c.canvas.width,this.c.canvas.height,this.c,this.state),this.keyHandler=new c,this.doDraw=!1,this.state.updateDisplay=function(){o.doDraw===!1&&(window.requestAnimationFrame(function(){return o.doDraw=!1,o.drawer.draw()}),o.doDraw=!0)},this.keyHandler.registerKeyDown(37,function(t){return o.state.moveLeft(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(38,function(t){return o.state.rotateRight(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(39,function(t){return o.state.moveRight(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(40,function(t){return o.state.moveDown(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(32,function(t){return o.state.doDrop(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(16,function(t){return o.state.storeBlock(),t.preventDefault(),!1}),this.draw(),n("clown").onload=function(){return o.draw()}}return t.prototype.draw=function(){this.drawer.draw()},t}(),o=null,$(document).ready(function(){var t
t=(new Date).getDate(),window.game=o=new f,r.debug&&console.debug((new Date).getDate()-t+" ms to launch game")})}).call(this)
var _gaq=_gaq||[]
_gaq.push(["_setAccount","UA-37350177-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script")
e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><canvas id="game" width="528" height="528"></canvas><br><a href="https://github.com/avdg/avdg.github.com/issues">Send feedback</a></body></body></html>