<!DOCTYPE html>
<html><head><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script><script type="text/javascript">(function(){var t,i,e,o,s,l,n,c,r,h,a,u,k,f
r={locale:!1,debug:!1,style:"srs"},i={_:!1,blockTypes:"ijlotsz".split(""),blocks:{srs:{rotate:function(t){return[t[1],-t[0]]},derotate:function(t){return[-t[1],t[0]]},opposite:function(t){return[-t[0],-t[1]]},initials:{i:[[0,-1],[0,0],[0,1],[0,2]],j:[[-1,-1],[0,-1],[0,0],[0,1]],l:[[0,-1],[0,0],[0,1],[-1,1]],o:[[-1,0],[0,0],[-1,1],[0,1]],s:[[0,-1],[0,0],[-1,0],[-1,1]],t:[[-1,0],[0,-1],[0,0],[0,1]],z:[[-1,-1],[-1,0],[0,0],[0,1]]},kickTable:{right:{o:[[],[],[],[]],i:[[[-2,0],[1,0],[-2,-1],[1,2]],[[-1,0],[2,0],[-1,2],[2,-1]],[[2,0],[-1,0],[2,1],[-1,-2]],[[1,0],[-2,0],[1,-2],[-2,1]]],"default":[[[-1,0],[-1,1],[0,-2],[-1,-2]],[[1,0],[1,-1],[0,2],[1,2]],[[1,0],[1,1],[0,-2],[1,-2]],[[-1,0],[-1,-1],[0,2],[-1,2]]]},left:{o:[[],[],[],[]],i:[[[2,0],[-1,0],[2,1],[-1,-2]],[[1,0],[-2,0],[1,-2],[-2,1]],[[-2,0],[1,0],[-2,-1],[1,2]],[[-1,0],[2,0],[-1,2],[2,-1]]],"default":[[[1,0],[1,-1],[0,2],[1,2]],[[-1,0],[-1,1],[0,-2],[-1,2]],[[-1,0],[-1,-1],[0,2],[-1,2]],[[1,0],[1,1],[0,-2],[1,-2]]]}},offsets:{i:[[[0,0],[-1,0],[2,0],[-1,0],[2,0]],[[-1,0],[0,0],[0,0],[0,1],[0,-2]],[[-1,2],[1,1],[-2,1],[1,0],[-2,0]],[[0,1],[0,1],[0,1],[0,-1],[0,2]]],o:[[[0,0]],[[0,-1]],[[-1,-1]],[[-1,0]]],"default":[[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[-1,0],[-1,1],[0,2],[-1,2]]]},color:{i:"rgba(0,255,255,.9)",j:"rgba(0,0,255,.9)",l:"rgba(255,170,0,.9)",o:"rgba(255,255,0,.9)",s:"rgba(0,255,0,.9)",t:"rgba(153,0,255,.9)",z:"rgba(255,0,0,.9)"},blocks:{}}},images:{cache:{},links:{clown:"http://tweakers.net/ext/f/QiUS8Q3QxzG4yC76TOl0RSHI/full.jpg",nature:"http://www.finewallpaperss.com/wp-content/uploads/2012/09/green-nature-wallpaper1.jpg"},offline:{clown:"img/clown.jpg",nature:"img/green-nature-wallpaper.jpg"}}},n=function(){var t,e,o,s,n,c,r,h,a,u,k
if(!i._){for(l("clown"),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()),a=i.blockTypes,n=0,h=a.length,k=1;h>n;n+=k)for(t=a[n],s=i.blocks.srs.initials[t].slice(0),i.blocks.srs.blocks[t]=[],e=c=0;4>c;e=c+=1)for(i.blocks.srs.blocks[t][e]=$.extend(!0,[],s),o=r=0,u=i.blocks.srs.initials[t].length;u>r;o=r+=1)s[o]=i.blocks.srs.rotate(s[o])
i._=!0}},t=function(){function t(){this.achievements={}}return t.prototype.add=function(t,i){this.achievement[t]={msg:i,unlocked:!1}},t.prototype.unlock=function(t){return(this.achievement[t].unlocked=!1)?(this.achievement[t].unlocked=!0,!0):!1},t.prototype.unlocked=function(t){return this.achievement[t].unlocked},t}(),k=function(){function t(){this.resetState(!0)}return t.prototype.resetState=function(t){var i,e,o,s,l
for(null==t&&(t=!1),this.activeBlock={block:null,rotation:null,w:null,h:null},this.display=[],this.wall=0,this.lineOffsets=[],this.hold=null,this.holdDisabled=!1,this.holdLock=!1,this.queue=[],this.totalLines=0,this.totalBlocksDropped=0,this.linesSingle=0,this.linesDouble=0,this.linesTriple=0,this.linesQuadro=0,t&&(this.settings=$.extend(!0,{},r)),this.rotationStyle="srs",i=o=0;24>o;i=++o)for(this.display[i]=[],e=s=0;10>s;e=++s)this.display[i][e]=null
for(i=l=0;20>l;i=++l)this.lineOffsets[i]=0
this.fillQueue(),this.nextBlock()},t.prototype.fillQueue=function(t){for(null==t&&(t=7);t>this.queue.length;)this.queue=this.queue.concat(h(i.blockTypes))},t.prototype.nextBlock=function(t,i){var e,o
for(null==t&&(t=1),null==i&&(i=7),e=o=0;t>o;e=o+=1)this.activeBlock.block=this.queue.shift(),this.activeBlock.rotation=0,this.activeBlock.h=18,this.activeBlock.w=4,i>this.queue.length&&this.fillQueue(i)},t.prototype.tryActiveBlockPosition=function(t,i,e){var o,s,l
for(o=s=0,l=e.length;l>s;o=s+=1){if(0>i-e[o][0]||i-e[o][0]>=20)return!1
if(0>t+e[o][1]||t+e[o][1]>=10)return!1
if(null!==this.display[i-e[o][0]][t+e[o][1]])return!1}return!0},t.prototype.storeBlock=function(){var t
this.holdDisabled||this.holdLock||(null===this.hold?(this.hold=this.activeBlock.block,this.nextBlock()):(t=[this.activeBlock.block,this.hold],this.hold=t[0],this.activeBlock.block=t[1],this.activeBlock.rotation=0,this.activeBlock.h=18,this.activeBlock.w=4),this.holdLock=!0,this.updateDisplay())},t.prototype.moveLeft=function(){this.tryActiveBlockPosition(this.activeBlock.w-1,this.activeBlock.h,i.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])&&(this.activeBlock.w-=1,this.updateDisplay())},t.prototype.moveRight=function(){this.tryActiveBlockPosition(this.activeBlock.w+1,this.activeBlock.h,i.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])&&(this.activeBlock.w+=1,this.updateDisplay())},t.prototype.moveDown=function(){this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h-1,i.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])?(this.activeBlock.h-=1,this.updateDisplay()):this.lock()},t.prototype.doDrop=function(){for(;this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h-1,i.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation]);)this.activeBlock.h-=1
this.lock()},t.prototype.rotateRight=function(){var t
t=(this.activeBlock.rotation+1)%4,this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,i.blocks.srs.blocks[this.activeBlock.block][t])&&(this.activeBlock.rotation=t,this.updateDisplay())},t.prototype.rotateLeft=function(){var t
t=(this.activeBlock.rotation+3)%4,this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,i.blocks.srs.blocks[this.activeBlock.block][t])&&(this.activeBlock.rotation=t,this.updateDisplay())},t.prototype.lock=function(){var t,e,o,s
for(this.holdLock=!1,this.totalBlocksDropped+=1,t=i.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation],e=o=0,s=t.length;s>o;e=o+=1)this.display[this.activeBlock.h-t[e][0]][this.activeBlock.w+t[e][1]]=i.blocks.srs.color[this.activeBlock.block]
this.removeLines(),this.nextBlock(),this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,i.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])||this.resetState(),this.updateDisplay()},t.prototype.removeLines=function(){var t,i,e,o,s,l,n,c
for(o=0,i=s=0,n=this.display.length;n>s;i=s+=1){for(t=!0,e=l=0,c=this.display[i].length;c>l;e=l+=1)this.display[i-o][e]=this.display[i][e],null===this.display[i][e]&&(t=!1)
t&&(o+=1)}switch(this.totalLines+=o,o){case 1:this.linesSingle+=1
break
case 2:this.linesDouble+=1
break
case 3:this.linesTriple+=1
break
case 4:this.linesQuadro+=1}this.updateDisplay()},t.prototype.updateDisplay=function(){},t.prototype.gameOver=function(){},t}(),e=function(){function t(t,i,e,o,s,l){this.resetSettings(),this.x=t,this.y=i,this.w=e,this.h=o,this.c=s,this.s=l,this.c.lineWidth=0}return t.prototype.resetSettings=function(){this.options={defaultClearColor:"rgb(255, 255, 255)",defaultBlockColor:"rgba(0, 0, 0, .5)",defaultBgColor:"rgb(0, 0, 0)",defaultBlockBgColor:"rgba(255, 255, 255, .3)",defaultGridBgColor:"rgba(255, 255, 255, .5)",image:"clown",rows:20,cols:10,ghostBlock:!0}},t.prototype.clearScreen=function(t){null==t&&(t=this.options.defaultClearColor),this.c.fillStyle=t,this.c.fillRect(this.x,this.y,this.w,this.h)},t.prototype.drawImageBackground=function(t,i,e,o,s){var n,c,r,h,a,u,k
null==s&&(s={}),r=24,c=e/r,n=o/r,a=c/2,h=l(null!=(u=s.image)?u:this.options.image),this.c.beginPath(),this.c.strokeStyle=this.c.fillStyle=null!=(k=s.defaultBgColor)?k:this.options.defaultBgColor,this.c.lineWidth=1,this.c.moveTo(t+2*c,i+n),this.c.arcTo(t+23*c,i+n,t+23*c,i+2*n,a),this.c.arcTo(t+23*c,i+23*n,t+22*c,i+23*n,a),this.c.arcTo(t+c,i+23*n,t+c,i+22*n,a),this.c.arcTo(t+c,i+n,t+2*c,i+n,a),this.c.closePath(),this.c.clip(),this.c.drawImage(h,t+c,i+n,e-c,o-n),this.c.restore(),this.c.lineWidth=0},t.prototype.drawGameGrid=function(t,e,o,s,l){var n,c,r,h,a,u,k,f,p,y,d,v,w,B,g,b,m,D,x,P,C,S,q
for(null==l&&(l={}),d=null!=(x=l.rows)?x:this.options.rows,r=null!=(P=l.cols)?P:this.options.cols,h=null!=(C=l.defaultBlockColor)?C:this.options.defaultBlockColor,a=null!=(S=l.defaultGridBgColor)?S:this.options.defaultGridBgColor,n=s/d,c=o/r,this.c.fillStyle=a,this.c.fillRect(t,e,o,s),this.c.fillStyle=h,f=B=0;d>B;f=B+=1)for(p=g=0;r>g;p=g+=1)this.c.fillRect(t+c*p+1,e+n*f+1,c-2,n-2)
for(k=this.s.activeBlock.h;this.s.tryActiveBlockPosition(this.s.activeBlock.w,k-1,i.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation]);)k-=1
for(y=0,u=n,f=b=0;d>b&&(y+=n+this.s.lineOffsets[f],y<=s+.05);f=b+=1){for(y+n>s+.05&&(u=y+n-s),p=m=0;r>m;p=m+=1)null!==this.s.display[f][p]&&(this.c.fillStyle=this.s.display[f][p],this.c.fillRect(t+c*p+1,e+s-y+1,c-2,u-2))
for(p=D=0,q=i.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation].length;q>D;p=D+=1)this.s.activeBlock.h-i.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][p][0]===f?(this.c.fillStyle=i.blocks.srs.color[this.s.activeBlock.block],this.c.fillRect(t+c*(i.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][p][1]+this.s.activeBlock.w)+1,e+s-y+1,c-2,n-2)):k-i.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][p][0]===f&&this.options.ghostBlock&&(v=t+c*(i.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][p][1]+this.s.activeBlock.w),w=e+s-y,this.c.lineWidth=2,this.c.strokeStyle=i.blocks.srs.color[this.s.activeBlock.block],this.c.beginPath(v+1,w+1),this.c.lineTo(v+c-2,w+1),this.c.lineTo(v+c-2,w+n-2),this.c.lineTo(v+1,w+n-2),this.c.lineTo(v+1,w+1),this.c.closePath(),this.c.stroke(),this.c.lineWdith=0)}},t.prototype.drawBox=function(t,e,o,s,l,n){var c,r,h,a,u,k,f,p,y,d,v,w,B,g,b,m,D,x,P,C,S
if(null==n&&(n={}),a=null!=(m=n.defaultBlockBgColor)?m:this.options.defaultBlockBgColor,h=o/4,r=s/4,"string"==typeof l?(c=null!=(D=null!=(x=n.blockColor)?x:i.blocks.srs.color[l])?D:this.options.defaultBlockColor,l=i.blocks.srs.blocks[l][0]):c=null!=(P=n.blockColor)?P:this.options.defaultBlockColor,this.c.fillStyle=a,this.c.fillRect(t,e,o,s),null!==l){for(y=f=l[0][0],d=p=l[0][1],k=g=1,C=l.length;C>g;k=g+=1)y>l[k][0]?y=l[k][0]:l[k][0]>f&&(f=l[k][0]),d>l[k][1]?d=l[k][1]:l[k][1]>p&&(p=l[k][1])
for(B=p-d+1,u=f-y+1,v=(4-B)/2*h,w=(4-u)/2*r,this.c.fillStyle=c,k=b=0,S=l.length;S>b;k=b+=1)this.c.fillRect(t+v+(l[k][1]-d)*h+1,e+w+(l[k][0]-y)*r+1,h-2,r-2)}},t.prototype.draw=function(){var t,i,e
e=(new Date).getDate(),i=this.w/24,t=this.h/24,this.clearScreen(),this.drawImageBackground(this.x,this.y,this.w,this.h),this.drawGameGrid(this.x+7*i,this.y+2*t,10*i,20*t),this.drawBox(this.x+18*i,this.y+2*t,4*i,4*t,this.s.queue[0]),this.drawBox(this.x+18*i,this.y+7*t,4*i,4*t,this.s.queue[1]),this.drawBox(this.x+18*i,this.y+12*t,4*i,4*t,this.s.queue[2]),this.drawBox(this.x+18*i,this.y+17*t,4*i,4*t,this.s.queue[3]),this.drawBox(this.x+2*i,this.y+2*t,4*i,4*t,this.s.hold),r.debug&&console.debug((new Date).getDate()-e+" ms spend drawing")},t}(),c=function(){function t(t){var i=this
null==t&&(t=!0),this.keys={keyUp:{},keyDown:{},keyPress:{}},this.keyDownFunction=function(t){return i.onKeyDown(t)},this.keyUpFunction=function(t){return i.onKeyUp(t)},this.keyPressFunction=function(t){return i.onKeyPress(t)},t&&this.registerEventHandlers()}return t.prototype.registerEventHandlers=function(){document.addEventListener("keydown",this.keyDownFunction,!1),document.addEventListener("keyup",this.keyUpFunction,!1),document.addEventListener("keypress",this.keyPressFunction,!1)},t.prototype.unregisterEventHandlers=function(){document.removeEventListener("keydown",this.keyDownFunction,!1),document.removeEventListener("keyup",this.keyUpFunction,!1),document.removeEventListener("keypress",this.keyPressFunction,!1)},t.prototype.registerKeyDown=function(t,i){this.keys.keyDown[t]=i},t.prototype.registerKeyUp=function(t,i){this.keys.keyUp[t]=i},t.prototype.registerKeyPress=function(t,i){this.keys.keyPress[t]=i},t.prototype.onKeyDown=function(t){var i
return i=t.which,"function"==typeof this.keys.keyDown[i]?this.keys.keyDown[i](t):"function"==typeof this.keys.keyDown["default"]?this.keys.keyDown["default"]:void 0},t.prototype.onKeyUp=function(t){var i
return i=t.which,"function"==typeof this.keys.keyUp[i]?this.keys.keyUp[i](t):"function"==typeof this.keys.keyUp["default"]?this.keys.keyUp["default"]:void 0},t.prototype.onKeyPress=function(t){var i
return i=t.which,"function"==typeof this.keys.keyPress[i]?this.keys.keyPress[i](t):"function"==typeof this.keys.keyPress["default"]?this.keys.keyPress["default"]:void 0},t.prototype.getKeyCode=function(){},t}(),h=function(t){var i,e,o,s,l,n
for(o=$.extend(!0,[],t),i=l=1,n=o.length;n>l;i=l+=1)e=Math.floor(Math.random()*(i+1)),s=o[i],o[i]=o[e],o[e]=s
return o},s=function(t,i){for(var e;0!==i;)e=[i,t%i],t=e[0],i=e[1]
return t},u=function(t,i,e,o){return e/o>t/i?o=i*e/t:e=t*o/i,[e,o]},a=function(t,i,e,o){return e/o>t/i?(e-=e%s(t,i),o=i*e/t):(o-=o%s(i,t),e=t*o/i),[e,o]},l=function(t){return i.images.cache[t]||(i.images.cache[t]=new Image,i.images.cache[t].src=i.images[r.locale?"offline":"links"][t],i.images.cache[t])},f=function(){function t(t){var o=this
n(),null==t&&(t="game"),this.c=document.getElementById(t).getContext("2d"),this.state=new k,r.debug&&(this.cache=i),this.drawer=new e(0,0,this.c.canvas.width,this.c.canvas.height,this.c,this.state),this.keyHandler=new c,this.doDraw=!1,this.state.updateDisplay=function(){o.doDraw===!1&&(window.requestAnimationFrame(function(){return o.doDraw=!1,o.drawer.draw()}),o.doDraw=!0)},this.keyHandler.registerKeyDown(37,function(t){return o.state.moveLeft(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(38,function(t){return o.state.rotateRight(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(39,function(t){return o.state.moveRight(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(40,function(t){return o.state.moveDown(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(32,function(t){return o.state.doDrop(),t.preventDefault(),!1}),this.keyHandler.registerKeyDown(16,function(t){return o.state.storeBlock(),t.preventDefault(),!1}),this.draw(),l("clown").onload=function(){return o.draw()}}return t.prototype.draw=function(){this.drawer.draw()},t}(),o=null,$(document).ready(function(){var t
t=(new Date).getDate(),window.game=o=new f,r.debug&&console.debug((new Date).getDate()-t+" ms to launch game")})}).call(this)
var _gaq=_gaq||[]
_gaq.push(["_setAccount","UA-37350177-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script")
e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><canvas id="game" width="528" height="528"></canvas><br><a href="https://github.com/avdg/avdg.github.com/issues">Send feedback</a></body></body></html>