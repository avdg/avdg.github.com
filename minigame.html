<!DOCTYPE html>
<html><head><meta charset="utf-8"><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script><script type="text/javascript">
(function(){var t,e,i,s,o,l,n,c,r,a,h,u,f,k;if(!window.requestAnimationFrame){window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()}a=function(t){var e,i,s,o,l,n;s=$.extend(true,[],t);for(e=l=1,n=s.length;l<n;e=l+=1){i=Math.floor(Math.random()*(e+1));o=s[e];s[e]=s[i];s[i]=o}return s};o=function(t,e){var i;while(e!==0){i=[e,t%e],t=i[0],e=i[1]}return t};u=function(t,e,i,s){if(t/e<i/s){s=e*i/t}else{i=t*s/e}return[i,s]};r={locale:true,debug:false,style:"srs"};e={_:false,blockTypes:"ijlotsz".split(""),blocks:{srs:{rotate:function(t){return[t[1],-t[0]]},derotate:function(t){return[-t[1],t[0]]},opposite:function(t){return[-t[0],-t[1]]},initials:{i:[[0,-1],[0,0],[0,1],[0,2]],j:[[-1,-1],[0,-1],[0,0],[0,1]],l:[[0,-1],[0,0],[0,1],[-1,1]],o:[[-1,0],[0,0],[-1,1],[0,1]],s:[[0,-1],[0,0],[-1,0],[-1,1]],t:[[-1,0],[0,-1],[0,0],[0,1]],z:[[-1,-1],[-1,0],[0,0],[0,1]]},kickTable:{right:{o:[[],[],[],[]],i:[[[-2,0],[1,0],[-2,-1],[1,2]],[[-1,0],[2,0],[-1,2],[2,-1]],[[2,0],[-1,0],[2,1],[-1,-2]],[[1,0],[-2,0],[1,-2],[-2,1]]],"default":[[[-1,0],[-1,1],[0,-2],[-1,-2]],[[1,0],[1,-1],[0,2],[1,2]],[[1,0],[1,1],[0,-2],[1,-2]],[[-1,0],[-1,-1],[0,2],[-1,2]]]},left:{o:[[],[],[],[]],i:[[[2,0],[-1,0],[2,1],[-1,-2]],[[1,0],[-2,0],[1,-2],[-2,1]],[[-2,0],[1,0],[-2,-1],[1,2]],[[-1,0],[2,0],[-1,2],[2,-1]]],"default":[[[1,0],[1,-1],[0,2],[1,2]],[[-1,0],[-1,1],[0,-2],[-1,2]],[[-1,0],[-1,-1],[0,2],[-1,2]],[[1,0],[1,1],[0,-2],[1,-2]]]}},offsets:{i:[[[0,0],[-1,0],[2,0],[-1,0],[2,0]],[[-1,0],[0,0],[0,0],[0,1],[0,-2]],[[-1,2],[1,1],[-2,1],[1,0],[-2,0]],[[0,1],[0,1],[0,1],[0,-1],[0,2]]],o:[[[0,0]],[[0,-1]],[[-1,-1]],[[-1,0]]],"default":[[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[-1,0],[-1,1],[0,2],[-1,2]]]},color:{i:"rgba(0,255,255,.9)",j:"rgba(0,0,255,.9)",l:"rgba(255,170,0,.9)",o:"rgba(255,255,0,.9)",s:"rgba(0,255,0,.9)",t:"rgba(153,0,255,.9)",z:"rgba(255,0,0,.9)"},blocks:{}}},images:{cache:{},links:{clown:"http://tweakers.net/ext/f/QiUS8Q3QxzG4yC76TOl0RSHI/full.jpg",nature:"http://www.finewallpaperss.com/wp-content/uploads/2012/09/green-nature-wallpaper1.jpg"},offline:{clown:"img/clown.jpg",nature:"img/green-nature-wallpaper.jpg"}}};n=function(){var t,i,s,o,n,c,r,a,h,u,f;if(e._){return}l("clown");h=e.blockTypes;for(n=0,a=h.length,f=1;n<a;n+=f){t=h[n];o=e.blocks.srs.initials[t].slice(0);e.blocks.srs.blocks[t]=[];for(i=c=0;c<4;i=c+=1){e.blocks.srs.blocks[t][i]=$.extend(true,[],o);for(s=r=0,u=e.blocks.srs.initials[t].length;r<u;s=r+=1){o[s]=e.blocks.srs.rotate(o[s])}}}e._=true};t=function(){function t(){this.achievements={}}t.prototype.add=function(t,e){this.achievement[t]={msg:e,unlocked:false}};t.prototype.unlock=function(t){if(this.achievement[t].unlocked=false){this.achievement[t].unlocked=true;return true}return false};t.prototype.unlocked=function(t){return this.achievement[t].unlocked};return t}();f=function(){function t(){this.resetState(true)}t.prototype.resetState=function(t){var e,i,s,o,l;if(t==null){t=false}this.activeBlock={block:null,rotation:null,w:null,h:null};this.display=[];this.wall=0;this.lineOffsets=[];this.hold=null;this.holdDisabled=false;this.holdLock=false;this.queue=[];this.totalLines=0;this.totalBlocksDropped=0;this.linesSingle=0;this.linesDouble=0;this.linesTriple=0;this.linesQuadro=0;this.lastLineType=null;this.lastLineIsTSpin=false;this.combo=0;this.maxCombo=0;this.backToBackTetrisCombo=0;this.backToBackTSpin=0;if(t){this.settings=$["extend"](true,{},r)}this.rotationStyle="srs";for(e=s=0;s<24;e=++s){this.display[e]=[];for(i=o=0;o<10;i=++o){this.display[e][i]=null}}for(e=l=0;l<20;e=++l){this.lineOffsets[e]=0}this.fillQueue();this.nextBlock()};t.prototype.fillQueue=function(t){if(t==null){t=7}while(this.queue.length<t){this.queue=this.queue.concat(a(e.blockTypes))}};t.prototype.nextBlock=function(t,e){var i,s;if(t==null){t=1}if(e==null){e=7}for(i=s=0;s<t;i=s+=1){this.activeBlock.block=this.queue.shift();this.activeBlock.rotation=0;this.activeBlock.h=18;this.activeBlock.w=4;if(this.queue.length<e){this.fillQueue(e)}}};t.prototype.tryActiveBlockPosition=function(t,e,i){var s,o,l;for(s=o=0,l=i.length;o<l;s=o+=1){if(e-i[s][0]<0||e-i[s][0]>=20){return false}if(t+i[s][1]<0||t+i[s][1]>=10){return false}if(this.display[e-i[s][0]][t+i[s][1]]!==null){return false}}return true};t.prototype.storeBlock=function(){var t;if(this.holdDisabled||this.holdLock){return}if(this.hold===null){this.hold=this.activeBlock.block;this.nextBlock()}else{t=[this.activeBlock.block,this.hold],this.hold=t[0],this.activeBlock.block=t[1];this.activeBlock.rotation=0;this.activeBlock.h=18;this.activeBlock.w=4}this.holdLock=true;this.updateDisplay()};t.prototype.moveLeft=function(){if(this.tryActiveBlockPosition(this.activeBlock.w-1,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])){this.activeBlock.w-=1;this.updateDisplay()}};t.prototype.moveRight=function(){if(this.tryActiveBlockPosition(this.activeBlock.w+1,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])){this.activeBlock.w+=1;this.updateDisplay()}};t.prototype.moveDown=function(){if(this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h-1,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])){this.activeBlock.h-=1;this.updateDisplay()}else{this.lock()}};t.prototype.doDrop=function(){while(this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h-1,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])){this.activeBlock.h-=1}this.lock()};t.prototype.rotateRight=function(){var t;t=(this.activeBlock.rotation+1)%4;if(this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][t])){this.activeBlock.rotation=t;this.updateDisplay()}};t.prototype.rotateLeft=function(){var t;t=(this.activeBlock.rotation+3)%4;if(this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][t])){this.activeBlock.rotation=t;this.updateDisplay()}};t.prototype.lock=function(){var t,i,s,o;this.holdLock=false;this.totalBlocksDropped+=1;t=e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation];for(i=s=0,o=t.length;s<o;i=s+=1){this.display[this.activeBlock.h-t[i][0]][this.activeBlock.w+t[i][1]]=e.blocks.srs.color[this.activeBlock.block]}this.removeLines(this.activeBlock.type);this.nextBlock();if(!this.tryActiveBlockPosition(this.activeBlock.w,this.activeBlock.h,e.blocks.srs.blocks[this.activeBlock.block][this.activeBlock.rotation])){this.resetState()}this.updateDisplay()};t.prototype.removeLines=function(t){var e,i,s,o,l,n,c,r;o=0;for(i=l=0,c=this.display.length;l<c;i=l+=1){e=true;for(s=n=0,r=this.display[i].length;n<r;s=n+=1){this.display[i-o][s]=this.display[i][s];if(this.display[i][s]===null){e=false}}if(e){o+=1}}this.totalLines+=o;switch(o){case 1:this.linesSingle+=1;this.lastLineType="single";if(t==="t"){"test"}break;case 2:this.linesDouble+=1;this.lastLineType="double";if(t==="t"){"test"}break;case 3:this.linesTriple+=1;this.lastLineType="triple";if(t==="t"){"test"}break;case 4:if(this.lastLineType==="quadro"){this.backToBackTetrisCombo+=1}else{this.lastLineType="quadro"}this.linesQuadro+=1;this.lastLineIsTSpin=false}this.updateDisplay()};t.prototype.updateDisplay=function(){};t.prototype.gameOver=function(){};return t}();i=function(){function t(t,e,i,s,o,l){this.resetSettings();this.x=t;this.y=e;this.w=i;this.h=s;this.c=o;this.s=l;this.c.lineWidth=0}t.prototype.resetSettings=function(){this.options={defaultClearColor:"rgb(255, 255, 255)",defaultBlockColor:"rgba(0, 0, 0, .5)",defaultBgColor:"rgb(0, 0, 0)",defaultBlockBgColor:"rgba(255, 255, 255, .3)",defaultGridBgColor:"rgba(255, 255, 255, .5)",image:"clown",rows:20,cols:10,ghostBlock:true}};t.prototype.clearScreen=function(t){if(t==null){t=this.options.defaultClearColor}this.c.fillStyle=t;this.c.fillRect(this.x,this.y,this.w,this.h)};t.prototype.drawImageBackground=function(t,e,i,s,o){var n,c,r,a,h,u,f;if(o==null){o={}}r=24;c=i/r;n=s/r;h=c/2;a=l((u=o.image)!=null?u:this.options.image);this.c.beginPath();this.c.strokeStyle=this.c.fillStyle=(f=o.defaultBgColor)!=null?f:this.options.defaultBgColor;this.c.lineWidth=1;this.c.moveTo(t+c*2,e+n);this.c.arcTo(t+c*23,e+n,t+c*23,e+n*2,h);this.c.arcTo(t+c*23,e+n*23,t+c*22,e+n*23,h);this.c.arcTo(t+c,e+n*23,t+c,e+n*22,h);this.c.arcTo(t+c,e+n,t+c*2,e+n,h);this.c.closePath();this.c.clip();this.c.drawImage(a,t+c,e+n,i-c,s-n);this.c.restore();this.c.lineWidth=0};t.prototype.drawGameGrid=function(t,i,s,o,l){var n,c,r,a,h,u,f,k,p,y,d,v,w,B,b,g,m,D,T,x,L,C,P;if(l==null){l={}}d=(T=l.rows)!=null?T:this.options.rows;r=(x=l.cols)!=null?x:this.options.cols;a=(L=l.defaultBlockColor)!=null?L:this.options.defaultBlockColor;h=(C=l.defaultGridBgColor)!=null?C:this.options.defaultGridBgColor;n=o/d;c=s/r;this.c.fillStyle=h;this.c.fillRect(t,i,s,o);this.c.fillStyle=a;for(k=B=0;B<d;k=B+=1){for(p=b=0;b<r;p=b+=1){this.c.fillRect(t+c*p+1,i+n*k+1,c-2,n-2)}}f=this.s.activeBlock.h;while(this.s.tryActiveBlockPosition(this.s.activeBlock.w,f-1,e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation])){f-=1}y=0;u=n;for(k=g=0;g<d;k=g+=1){y+=n+this.s.lineOffsets[k];if(y>o+.05){break}else if(y+n>o+.05){u=y+n-o}for(p=m=0;m<r;p=m+=1){if(this.s.display[k][p]!==null){this.c.fillStyle=this.s.display[k][p];this.c.fillRect(t+c*p+1,i+o-y+1,c-2,u-2)}}for(p=D=0,P=e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation].length;D<P;p=D+=1){if(this.s.activeBlock.h-e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][p][0]===k){this.c.fillStyle=e.blocks.srs.color[this.s.activeBlock.block];this.c.fillRect(t+c*(e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][p][1]+this.s.activeBlock.w)+1,i+o-y+1,c-2,n-2)}else if(f-e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][p][0]===k&&this.options.ghostBlock){v=t+c*(e.blocks.srs.blocks[this.s.activeBlock.block][this.s.activeBlock.rotation][p][1]+this.s.activeBlock.w);w=i+o-y;this.c.lineWidth=2;this.c.strokeStyle=e.blocks.srs.color[this.s.activeBlock.block];this.c.beginPath();this.c.moveTo(v+1,w+1);this.c.lineTo(v+c-2,w+1);this.c.lineTo(v+c-2,w+n-2);this.c.lineTo(v+1,w+n-2);this.c.closePath();this.c.stroke();this.c.lineWdith=0}}}};t.prototype.drawBox=function(t,i,s,o,l,n){var c,r,a,h,u,f,k,p,y,d,v,w,B,b,g,m,D,T,x,L,C;if(n==null){n={}}h=(m=n.defaultBlockBgColor)!=null?m:this.options.defaultBlockBgColor;a=s/4;r=o/4;if(typeof l==="string"){c=(D=(T=n.blockColor)!=null?T:e.blocks.srs.color[l])!=null?D:this.options.defaultBlockColor;l=e.blocks.srs.blocks[l][0]}else{c=(x=n.blockColor)!=null?x:this.options.defaultBlockColor}this.c.fillStyle=h;this.c.fillRect(t,i,s,o);if(l===null){return}y=k=l[0][0];d=p=l[0][1];for(f=b=1,L=l.length;b<L;f=b+=1){if(l[f][0]<y){y=l[f][0]}else if(l[f][0]>k){k=l[f][0]}if(l[f][1]<d){d=l[f][1]}else if(l[f][1]>p){p=l[f][1]}}B=p-d+1;u=k-y+1;v=(4-B)/2*a;w=(4-u)/2*r;this.c.fillStyle=c;for(f=g=0,C=l.length;g<C;f=g+=1){this.c.fillRect(t+v+(l[f][1]-d)*a+1,i+w+(l[f][0]-y)*r+1,a-2,r-2)}};t.prototype.draw=function(){var t,e,i;i=(new Date).getDate();e=this.w/24;t=this.h/24;this.clearScreen();this.drawImageBackground(this.x,this.y,this.w,this.h);this.drawGameGrid(this.x+e*7,this.y+t*2,e*10,t*20);this.drawBox(this.x+e*18,this.y+t*2,e*4,t*4,this.s.queue[0]);this.drawBox(this.x+e*18,this.y+t*7,e*4,t*4,this.s.queue[1]);this.drawBox(this.x+e*18,this.y+t*12,e*4,t*4,this.s.queue[2]);this.drawBox(this.x+e*18,this.y+t*17,e*4,t*4,this.s.queue[3]);this.drawBox(this.x+e*2,this.y+t*2,e*4,t*4,this.s.hold);if(r.debug){console.debug((new Date).getDate()-i+" ms spend drawing")}};return t}();c=function(){function t(t){var e=this;if(t==null){t=true}this.keys={keyUp:{},keyDown:{},keyPress:{}};this.keyDownFunction=function(t){return e.onKeyDown(t)};this.keyUpFunction=function(t){return e.onKeyUp(t)};this.keyPressFunction=function(t){return e.onKeyPress(t)};if(t){this.registerEventHandlers()}return}t.prototype.registerEventHandlers=function(){document.addEventListener("keydown",this.keyDownFunction,false);document.addEventListener("keyup",this.keyUpFunction,false);document.addEventListener("keypress",this.keyPressFunction,false)};t.prototype.unregisterEventHandlers=function(){document.removeEventListener("keydown",this.keyDownFunction,false);document.removeEventListener("keyup",this.keyUpFunction,false);document.removeEventListener("keypress",this.keyPressFunction,false)};t.prototype.registerKeyDown=function(t,e){this.keys.keyDown[t]=e};t.prototype.registerKeyUp=function(t,e){this.keys.keyUp[t]=e};t.prototype.registerKeyPress=function(t,e){this.keys.keyPress[t]=e};t.prototype.onKeyDown=function(t){var e;e=t.which;if(typeof this.keys.keyDown[e]==="function"){return this.keys.keyDown[e](t)}else if(typeof this.keys.keyDown["default"]==="function"){return this.keys.keyDown["default"]}};t.prototype.onKeyUp=function(t){var e;e=t.which;if(typeof this.keys.keyUp[e]==="function"){return this.keys.keyUp[e](t)}else if(typeof this.keys.keyUp["default"]==="function"){return this.keys.keyUp["default"]}};t.prototype.onKeyPress=function(t){var e;e=t.which;if(typeof this.keys.keyPress[e]==="function"){return this.keys.keyPress[e](t)}else if(typeof this.keys.keyPress["default"]==="function"){return this.keys.keyPress["default"]}};return t}();h=function(t,e,i,s){if(t/e<i/s){i=i-i%o(t,e);s=e*i/t}else{s=s-s%o(e,t);i=t*s/e}return[i,s]};l=function(t){return e.images.cache[t]||(e.images.cache[t]=new Image,e.images.cache[t].src=e.images[r.locale?"offline":"links"][t],e.images.cache[t])};k=function(){function t(t){var s=this;n();if(t==null){t="game"}this.c=document.getElementById(t).getContext("2d");this.state=new f;if(r.debug){this.cache=e}this.drawer=new i(0,0,this.c.canvas.width,this.c.canvas.height,this.c,this.state);this.keyHandler=new c;this.doDraw=false;this.state.updateDisplay=function(){if(s.doDraw===false){window.requestAnimationFrame(function(){s.doDraw=false;return s.drawer.draw()});s.doDraw=true}};this.keyHandler.registerKeyDown(37,function(t){s.state.moveLeft();t.preventDefault();return false});this.keyHandler.registerKeyDown(38,function(t){s.state.rotateRight();t.preventDefault();return false});this.keyHandler.registerKeyDown(39,function(t){s.state.moveRight();t.preventDefault();return false});this.keyHandler.registerKeyDown(40,function(t){s.state.moveDown();t.preventDefault();return false});this.keyHandler.registerKeyDown(32,function(t){s.state.doDrop();t.preventDefault();return false});this.keyHandler.registerKeyDown(16,function(t){s.state.storeBlock();t.preventDefault();return false});this.keyHandler.registerKeyDown(17,function(t){s.state.rotateLeft();t.preventDefault();return false});this.draw();l("clown").onload=function(){return s.draw()}}t.prototype.draw=function(){this.drawer.draw()};return t}();s=null;$(document)["ready"](function(){var t;t=(new Date).getDate();window.game=s=new k;if(r.debug){console.debug((new Date).getDate()-t+" ms to launch game")}})}).call(this);
var _gaq=_gaq||[]
_gaq.push(["_setAccount","UA-37350177-1"],["_trackPageview"]),function(){var t,e=document.createElement("script")
e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><canvas id="game" width="528" height="528"></canvas><br><a href="https://github.com/avdg/jsTetris">Source</a></body></body></html>
